
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Index - AI Meal Planner</title>
  <meta name="description" content="Your personal AI meal planner for healthy and delicious meals.">
  <meta name="keywords" content="meal planner, AI, healthy eating, recipes">
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">
</head>
<body class="index-page">
  <header id="header" class="header d-flex align-items-center sticky-top">
    <div class="container position-relative d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center me-auto me-xl-0">
        <h1 class="sitename">AI Meal Planner</h1>
        <span>.</span>
      </a>
      <nav id="navmenu" class="navmenu">
        <ul>
          <!-- <li><a href="dashboard.html" class="active">Home<br></a></li> -->
          <!-- <li><a href="#contact">Contact</a></li> -->
          <!-- <li><a href="#about">About</a></li>           -->
          <li><a href="plan.html" class="active">Meal Plan</a></li>
          <li><a href="history.html">History</a></li>
          <li><a href="profile.html">Profile</a></li>
          <li><a href="dashboard.html">logout</a></li>
        </ul>
        <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
      </nav>
      <!-- <a class="btn-getstarted" href="index.html">Get Started</a> -->
    </div>
  </header>

  <main class="container my-5">
    <h2 class="text-center mb-4">Create a Personalized Desi Meal Plan</h2>

    <form id="mealForm" class="card p-4 shadow-sm rounded-4 mb-5">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">Age</label>
          <input type="number" name="age" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Weight (kg)</label>
          <input type="number" name="weight" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Height (cm)</label>
          <input type="number" name="height" class="form-control" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Gender</label>
          <select name="gender" class="form-select" required>
            <option value="">--Select--</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Activity Level</label>
          <select name="activity" class="form-select">
            <option value="sedentary">Sedentary</option>
            <option value="lightly active">Lightly Active</option>
            <option value="moderately active">Moderately Active</option>
            <option value="very active">Very Active</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Dietary Goal</label>
          <select name="goal" class="form-select">
            <option value="maintenance">Maintenance</option>
            <option value="weight loss">Weight Loss</option>
            <option value="weight gain">Weight Gain</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Dietary Restrictions</label>
          <select name="restriction" class="form-select">
            <option value="none">None</option>
            <option value="vegetarian">Vegetarian</option>
            <option value="vegan">Vegan</option>
            <option value="gluten-free">Gluten-Free</option>
            <option value="dairy-free">Dairy-Free</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Plan Duration (days)</label>
          <select name="duration" id="duration" class="form-select">
            <option value="3">3</option>
            <option value="7">7</option>
            <option value="14">14</option>
            <option value="30">30</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div class="col-md-4" id="customDaysWrapper" style="display: none;">
          <label class="form-label">Enter Custom Days</label>
          <input type="number" name="customDays" id="customDays" class="form-control" min="1" />
        </div>
      </div>

      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary px-5">Generate Plan</button>
      </div>
    </form>

    <div id="planResult"></div>
  </main>

  
 

  <footer id="footer" class="footer dark-background">
    <div class="container">
      <div class="row gy-3">
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-geo-alt icon"></i>
          <div class="address">
            <h4>Address</h4>
            <p>A108 Adam Street</p>
            <p>New York, NY 535022</p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-telephone icon"></i>
          <div>
            <h4>Contact</h4>
            <p>
              <strong>Phone:</strong> <span>+1 5589 55488 55</span><br>
              <strong>Email:</strong> <span>info@aimealplanner.com</span><br>
            </p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 d-flex">
          <i class="bi bi-clock icon"></i>
          <div>
            <h4>Opening Hours</h4>
            <p>
              <strong>Mon-Sat:</strong> <span>9AM - 9PM</span><br>
              <strong>Sunday</strong>: <span>Closed</span>
            </p>
          </div>
        </div>
        <div class="col-lg-3 col-md-6">
          <h4>Follow Us</h4>
          <div class="social-links d-flex">
            <a href="#" class="twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="#" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="#" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="#" class="linkedin"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
      </div>
    </div>
    <div class="container copyright text-center mt-4">
      <p>Â© <span>Copyright</span> <strong class="px-1 sitename">AI Meal Planner</strong> <span>All Rights Reserved</span></p>
      <div class="credits">
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a> Distributed by <a href="https://themewagon.com">ThemeWagon</a>
      </div>
    </div>
  </footer>
  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
  <!-- Preloader -->
  <div id="preloader"></div>
  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
  import { auth, db } from './assets/js/firebase-config.js';
  import {
    onAuthStateChanged,
    signOut
  } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js';
  import {
    collection,
    addDoc,
    serverTimestamp
  } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js';

  let currentUser = null;

  onAuthStateChanged(auth, user => {
    if (!user) {
      location.href = 'index.html';
    } else {
      currentUser = user;
    }
  });

  window.logout = async function () {
    await signOut(auth);
    location.href = 'index.html';
  };

  // Show/hide custom days input
  document.getElementById("duration").addEventListener("change", function () {
    const custom = document.getElementById("customDays");
    custom.style.display = this.value === "custom" ? "inline-block" : "none";
  });

  // Handle form submit
  document.getElementById("mealForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    const inputs = {
      age: formData.get("age"),
      weight: formData.get("weight"),
      height: formData.get("height"),
      gender: formData.get("gender"),
      activity: formData.get("activity"),
      goal: formData.get("goal"),
      restriction: formData.get("restriction"),
      duration: formData.get("duration") === "custom" ? formData.get("customDays") : formData.get("duration"),
    };

    generatePlan(inputs);
  });

 window.generatePlan = async function (inputs) {
  const planResult = document.getElementById("planResult");
  planResult.innerHTML = "<p>Generating your meal plan...</p>";

  try {
    const aiRes = await fetch("http://localhost:3001/generate-meal-plan", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(inputs),
    });

    const { plan } = await aiRes.json();

    if (!Array.isArray(plan)) throw new Error("Invalid plan format from server");

    // ð Fetch Pexels images for each meal
    for (const day of plan) {
      for (const type of ["breakfast", "lunch", "dinner"]) {
        const mealName = day[type]?.meal || "";
        if (!mealName) continue;

        try {
          const res = await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(mealName)} indian food&per_page=1`, {
            headers: {
              Authorization: "FVQAKFSJRjPLvcNCrRWYsiADZvsWmnZs3XSAf9FY0BeWLkSJ6RHElsSA" // ð Replace this with your actual key
            }
          });
          const imgData = await res.json();
          day[type].image = imgData.photos?.[0]?.src?.medium || "";
        } catch (e) {
          console.warn(`Image fetch failed for ${mealName}`, e);
          day[type].image = "";
        }
      }
    }

    // Render meal cards with images
    const html = plan.map(day => {
      const { day: dayLabel, breakfast, lunch, dinner } = day;

      return `
        <div class="day-card">
          <h3>${dayLabel}</h3>
          
          <div class="meal-card" onclick="toggleIngredients('${dayLabel}-breakfast')">
            ${breakfast.image ? `<img src="${breakfast.image}" alt="Breakfast Image" width="200" />` : ""}
            <p><strong>Breakfast: ${breakfast.meal}</strong></p>
            <p>Calories: ${breakfast.calories}</p>
            <ul id="ingredients-${dayLabel}-breakfast" style="display:none;">
              ${breakfast.ingredients.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </div>

          <div class="meal-card" onclick="toggleIngredients('${dayLabel}-lunch')">
            ${lunch.image ? `<img src="${lunch.image}" alt="Lunch Image" width="200" />` : ""}
            <p><strong>Lunch: ${lunch.meal}</strong></p>
            <p>Calories: ${lunch.calories}</p>
            <ul id="ingredients-${dayLabel}-lunch" style="display:none;">
              ${lunch.ingredients.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </div>

          <div class="meal-card" onclick="toggleIngredients('${dayLabel}-dinner')">
            ${dinner.image ? `<img src="${dinner.image}" alt="Dinner Image" width="200" />` : ""}
            <p><strong>Dinner: ${dinner.meal}</strong></p>
            <p>Calories: ${dinner.calories}</p>
            <ul id="ingredients-${dayLabel}-dinner" style="display:none;">
              ${dinner.ingredients.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </div>
        </div>
      `;
    }).join("");

    planResult.innerHTML = `
      <h3>Your AI Meal Plan</h3>
      <p><strong>Total Days:</strong> ${plan.length}</p>
      <div class="meal-grid">${html}</div>
    `;

    await addDoc(collection(db, "plans"), {
      userId: currentUser.uid,
      plan,
      createdAt: serverTimestamp()
    });

  } catch (err) {
    console.error("Error generating plan:", err);
    planResult.innerHTML = `<p style="color:red;">Failed to generate plan: ${err.message}</p>`;
  }
};

 window.toggleIngredients = function (id) {
  const ul = document.getElementById(`ingredients-${id}`);
  if (ul) {
    ul.style.display = ul.style.display === "none" ? "block" : "none";
  }
};




</script>


</body>
</html>

